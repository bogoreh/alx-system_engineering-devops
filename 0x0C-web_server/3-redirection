#!/usr/bin/env bash
# Configures your Nginx server so that /redirect_me is redirecting to another page.
sudo apt -y update
sudo apt -y upgrade
sudo apt-get -y install nginx
sudo ufw allow 'Nginx HTTP'
sudo ufw enable
echo "Hello World!" | sudo tee '/var/www/html/index.nginx-debian.html'  > /dev/null

SERVER_CONFIG="server_name _;\nlocation / {\n\ttry_files \$uri \$uri/ =404;\n}\nif (\$request_filename ~ redirect_me){\n\trewrite ^ https://www.youtube.com/watch?v=QH2-TGUlwu4 permanent;\n}"

bash -c "echo -e '$SERVER_CONFIG' > /etc/nginx/sites-enabled/default"

current_string="server_name _;"
#new_string="server_name _;\n\trewrite ^/redirect_me https://www.youtube.com/watch?v=QH2-TGUlwu4 permanent;"

sudo sed -i "s|$current_string|$SERVER_CONFIG|g" /etc/nginx/sites-available/default
sudo ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default
sudo service nginx start
